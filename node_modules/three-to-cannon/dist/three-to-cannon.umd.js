!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cannon-es"),require("three")):"function"==typeof define&&define.amd?define(["exports","cannon-es","three"],t):t((e||self).threeToCannon={},e.cannonEs,e.THREE)}(this,function(e,t,n){var i=function(){var e,t,i,r,o=new n.Vector3;function s(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new c,this.unassigned=new c,this.vertices=[]}function a(){this.normal=new n.Vector3,this.midpoint=new n.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function u(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}function h(e){this.point=e,this.prev=null,this.next=null,this.face=null}function c(){this.head=null,this.tail=null}return Object.assign(s.prototype,{setFromPoints:function(e){!0!==Array.isArray(e)&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.vertices.push(new h(e[t]));return this.compute(),this},setFromObject:function(e){var t=[];return e.updateMatrixWorld(!0),e.traverse(function(e){var i,r,o,s=e.geometry;if(void 0!==s&&(s.isGeometry&&(s=s.toBufferGeometry?s.toBufferGeometry():(new n.BufferGeometry).fromGeometry(s)),s.isBufferGeometry)){var a=s.attributes.position;if(void 0!==a)for(i=0,r=a.count;i<r;i++)(o=new n.Vector3).fromBufferAttribute(a,i).applyMatrix4(e.matrixWorld),t.push(o)}}),this.setFromPoints(t)},containsPoint:function(e){for(var t=this.faces,n=0,i=t.length;n<i;n++)if(t[n].distanceToPoint(e)>this.tolerance)return!1;return!0},intersectRay:function(e,t){for(var n=this.faces,i=-Infinity,r=Infinity,o=0,s=n.length;o<s;o++){var a=n[o],u=a.distanceToPoint(e.origin),h=a.normal.dot(e.direction);if(u>0&&h>=0)return null;var c=0!==h?-u/h:0;if(!(c<=0)&&(h>0?r=Math.min(c,r):i=Math.max(c,i),i>r))return null}return e.at(-Infinity!==i?i:r,t),t},intersectsRay:function(e){return null!==this.intersectRay(e,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(e,t){return e.face=t,null===t.outside?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this},removeVertexFromFace:function(e,t){return e===t.outside&&(t.outside=null!==e.next&&e.next.face===t?e.next:null),this.assigned.remove(e),this},removeAllVerticesFromFace:function(e){if(null!==e.outside){for(var t=e.outside,n=e.outside;null!==n.next&&n.next.face===e;)n=n.next;return this.assigned.removeSubList(t,n),t.prev=n.next=null,e.outside=null,t}},deleteFaceVertices:function(e,t){var n=this.removeAllVerticesFromFace(e);if(void 0!==n)if(void 0===t)this.unassigned.appendChain(n);else{var i=n;do{var r=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=r}while(null!==i)}return this},resolveUnassignedPoints:function(e){if(!1===this.unassigned.isEmpty()){var t=this.unassigned.first();do{for(var n=t.next,i=this.tolerance,r=null,o=0;o<e.length;o++){var s=e[o];if(0===s.mark){var a=s.distanceToPoint(t.point);if(a>i&&(i=a,r=s),i>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(t,r),t=n}while(null!==t)}return this},computeExtremes:function(){var e,t,i,r=new n.Vector3,o=new n.Vector3,s=[],a=[];for(e=0;e<3;e++)s[e]=a[e]=this.vertices[0];for(r.copy(this.vertices[0].point),o.copy(this.vertices[0].point),e=0,t=this.vertices.length;e<t;e++){var u=this.vertices[e],h=u.point;for(i=0;i<3;i++)h.getComponent(i)<r.getComponent(i)&&(r.setComponent(i,h.getComponent(i)),s[i]=u);for(i=0;i<3;i++)h.getComponent(i)>o.getComponent(i)&&(o.setComponent(i,h.getComponent(i)),a[i]=u)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(r.x),Math.abs(o.x))+Math.max(Math.abs(r.y),Math.abs(o.y))+Math.max(Math.abs(r.z),Math.abs(o.z))),{min:s,max:a}},computeInitialHull:function(){void 0===e&&(e=new n.Line3,t=new n.Plane,i=new n.Vector3);var r,o,s,u,h,c,l,p,f,d=this.vertices,m=this.computeExtremes(),v=m.min,g=m.max,x=0,y=0;for(c=0;c<3;c++)(f=g[c].point.getComponent(c)-v[c].point.getComponent(c))>x&&(x=f,y=c);for(x=0,e.set((o=v[y]).point,(s=g[y]).point),c=0,l=this.vertices.length;c<l;c++)(r=d[c])!==o&&r!==s&&(e.closestPointToPoint(r.point,!0,i),(f=i.distanceToSquared(r.point))>x&&(x=f,u=r));for(x=-1,t.setFromCoplanarPoints(o.point,s.point,u.point),c=0,l=this.vertices.length;c<l;c++)(r=d[c])!==o&&r!==s&&r!==u&&(f=Math.abs(t.distanceToPoint(r.point)))>x&&(x=f,h=r);var w=[];if(t.distanceToPoint(h.point)<0)for(w.push(a.create(o,s,u),a.create(h,s,o),a.create(h,u,s),a.create(h,o,u)),c=0;c<3;c++)p=(c+1)%3,w[c+1].getEdge(2).setTwin(w[0].getEdge(p)),w[c+1].getEdge(1).setTwin(w[p+1].getEdge(0));else for(w.push(a.create(o,u,s),a.create(h,o,s),a.create(h,s,u),a.create(h,u,o)),c=0;c<3;c++)p=(c+1)%3,w[c+1].getEdge(2).setTwin(w[0].getEdge((3-c)%3)),w[c+1].getEdge(0).setTwin(w[p+1].getEdge(1));for(c=0;c<4;c++)this.faces.push(w[c]);for(c=0,l=d.length;c<l;c++)if((r=d[c])!==o&&r!==s&&r!==u&&r!==h){x=this.tolerance;var T=null;for(p=0;p<4;p++)(f=this.faces[p].distanceToPoint(r.point))>x&&(x=f,T=this.faces[p]);null!==T&&this.addVertexToFace(r,T)}return this},reindexFaces:function(){for(var e=[],t=0;t<this.faces.length;t++){var n=this.faces[t];0===n.mark&&e.push(n)}return this.faces=e,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var e,t=0,n=this.assigned.first().face,i=n.outside;do{var r=n.distanceToPoint(i.point);r>t&&(t=r,e=i),i=i.next}while(null!==i&&i.face===n);return e}},computeHorizon:function(e,t,n,i){var r;this.deleteFaceVertices(n),n.mark=1,r=null===t?t=n.getEdge(0):t.next;do{var o=r.twin,s=o.face;0===s.mark&&(s.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,s,i):i.push(r)),r=r.next}while(r!==t);return this},addAdjoiningFace:function(e,t){var n=a.create(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setTwin(t.twin),n.getEdge(0)},addNewFaces:function(e,t){this.newFaces=[];for(var n=null,i=null,r=0;r<t.length;r++){var o=this.addAdjoiningFace(e,t[r]);null===n?n=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return n.next.setTwin(i),this},addVertexToHull:function(e){var t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var e;for(this.computeInitialHull();void 0!==(e=this.nextVertexToAdd());)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(a,{create:function(e,t,n){var i=new a,r=new u(e,i),o=new u(t,i),s=new u(n,i);return r.next=s.prev=o,o.next=r.prev=s,s.next=o.prev=r,i.edge=r,i.compute()}}),Object.assign(a.prototype,{getEdge:function(e){for(var t=this.edge;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t},compute:function(){void 0===r&&(r=new n.Triangle);var e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return r.set(e.point,t.point,i.point),r.getNormal(this.normal),r.getMidpoint(this.midpoint),this.area=r.getArea(),this.constant=this.normal.dot(this.midpoint),this},distanceToPoint:function(e){return this.normal.dot(e)-this.constant}}),Object.assign(u.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceTo(e.point):-1},lengthSquared:function(){var e=this.head(),t=this.tail();return null!==t?t.point.distanceToSquared(e.point):-1},setTwin:function(e){return this.twin=e,e.twin=this,this}}),Object.assign(c.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(e,t){return t.prev=e.prev,t.next=e,null===t.prev?this.head=t:t.prev.next=t,e.prev=t,this},insertAfter:function(e,t){return t.prev=e,t.next=e.next,null===t.next?this.tail=t:t.next.prev=t,e.next=t,this},append:function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},appendChain:function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},remove:function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,this},removeSubList:function(e,t){return null===e.prev?this.head=t.next:e.prev.next=t.next,null===t.next?this.tail=e.prev:t.next.prev=e.prev,this},isEmpty:function(){return null===this.head}}),s}(),r=new n.Vector3,o=new n.Vector3,s=new n.Quaternion;function a(e){var t,i=function(e){var t=[];return e.traverse(function(e){e.isMesh&&t.push(e)}),t}(e);if(0===i.length)return null;if(1===i.length)return u(i[0]);for(var r=[];t=i.pop();)r.push(l(u(t)));return function(e){for(var t=0,i=0;i<e.length;i++){var r=e[i].attributes.position;r&&3===r.itemSize&&(t+=r.count)}for(var o=new Float32Array(3*t),s=0,a=0;a<e.length;a++){var u=e[a].attributes.position;if(u&&3===u.itemSize)for(var h=0;h<u.count;h++)o[s++]=u.getX(h),o[s++]=u.getY(h),o[s++]=u.getZ(h)}return(new n.BufferGeometry).setAttribute("position",new n.BufferAttribute(o,3))}(r)}function u(e){var t=e.geometry;return t=t.toBufferGeometry?t.toBufferGeometry():t.clone(),e.updateMatrixWorld(),e.matrixWorld.decompose(r,s,o),t.scale(o.x,o.y,o.z),t}function h(e){for(var t=e.attributes.position,n=new Float32Array(3*t.count),i=0;i<t.count;i+=3)n[i]=t.getX(i),n[i+1]=t.getY(i),n[i+2]=t.getZ(i);return n}function c(e,t){switch(t){case"x":return e.x;case"y":return e.y;case"z":return e.z}throw new Error("Unexpected component "+t)}function l(e,t){void 0===t&&(t=1e-4),t=Math.max(t,Number.EPSILON);for(var i={},r=e.getIndex(),o=e.getAttribute("position"),s=r?r.count:o.count,a=0,u=[],h=[],c=Math.log10(1/t),l=Math.pow(10,c),p=0;p<s;p++){var f=r?r.getX(p):p,d="";d+=~~(o.getX(f)*l)+",",d+=~~(o.getY(f)*l)+",",(d+=~~(o.getZ(f)*l)+",")in i?u.push(i[d]):(h.push(o.getX(f)),h.push(o.getY(f)),h.push(o.getZ(f)),i[d]=a,u.push(a),a++)}var m=new n.BufferAttribute(new Float32Array(h),o.itemSize,o.normalized),v=new n.BufferGeometry;return v.setAttribute("position",m),v.setIndex(u),v}var p,f=Math.PI/2;function d(e){if(!h(e).length)return null;e.computeBoundingBox();var n=e.boundingBox;return{shape:new t.Box(new t.Vec3((n.max.x-n.min.x)/2,(n.max.y-n.min.y)/2,(n.max.z-n.min.z)/2))}}function m(e){var i=e.clone();i.quaternion.set(0,0,0,1),i.updateMatrixWorld();var r=(new n.Box3).setFromObject(i);if(!isFinite(r.min.lengthSq()))return null;var o=new t.Box(new t.Vec3((r.max.x-r.min.x)/2,(r.max.y-r.min.y)/2,(r.max.z-r.min.z)/2)),s=r.translate(i.position.negate()).getCenter(new n.Vector3);return{shape:o,offset:s.lengthSq()?new t.Vec3(s.x,s.y,s.z):void 0}}e.ShapeType=void 0,(p=e.ShapeType||(e.ShapeType={})).BOX="Box",p.CYLINDER="Cylinder",p.SPHERE="Sphere",p.HULL="ConvexPolyhedron",p.MESH="Trimesh",e.threeToCannon=function(r,o){var s;if(void 0===o&&(o={}),o.type===e.ShapeType.BOX)return m(r);if(o.type===e.ShapeType.CYLINDER)return function(e,i){var r=["x","y","z"],o=i.cylinderAxis||"y",s=r.splice(r.indexOf(o),1)&&r,a=(new n.Box3).setFromObject(e);if(!isFinite(a.min.lengthSq()))return null;var u=a.max[o]-a.min[o],h=.5*Math.max(c(a.max,s[0])-c(a.min,s[0]),c(a.max,s[1])-c(a.min,s[1])),l=new t.Cylinder(h,h,u,12);l.radiusTop=h,l.radiusBottom=h,l.height=u,l.numSegments=12;var p="y"===o?f:0,d="z"===o?f:0;return{shape:l,orientation:(new t.Quaternion).setFromEuler(p,d,0,"XYZ").normalize()}}(r,o);if(o.type===e.ShapeType.SPHERE)return function(e,n){if(n.sphereRadius)return{shape:new t.Sphere(n.sphereRadius)};var i=a(e);return i?(i.computeBoundingSphere(),{shape:new t.Sphere(i.boundingSphere.radius)}):null}(r,o);if(o.type===e.ShapeType.HULL)return function(e){var r=a(e);if(!r)return null;for(var o=1e-4,s=0;s<r.attributes.position.count;s++)r.attributes.position.setXYZ(s,r.attributes.position.getX(s)+(Math.random()-.5)*o,r.attributes.position.getY(s)+(Math.random()-.5)*o,r.attributes.position.getZ(s)+(Math.random()-.5)*o);for(var u=(new i).setFromObject(new n.Mesh(r)).faces,h=[],c=[],l=0;l<u.length;l++){var p=u[l],f=[];c.push(f);var d=p.edge;do{var m=d.head().point;h.push(new t.Vec3(m.x,m.y,m.z)),f.push(h.length-1),d=d.next}while(d!==p.edge)}return{shape:new t.ConvexPolyhedron({vertices:h,faces:c})}}(r);if(o.type===e.ShapeType.MESH)return(s=a(r))?function(e){var n=h(e);if(!n.length)return null;var i=Object.keys(n).map(Number);return{shape:new t.Trimesh(n,i)}}(s):null;if(o.type)throw new Error('[CANNON.threeToCannon] Invalid type "'+o.type+'".');if(!(s=a(r)))return null;switch(s.type){case"BoxGeometry":case"BoxBufferGeometry":return d(s);case"CylinderGeometry":case"CylinderBufferGeometry":return function(e){var i=e.parameters,r=new t.Cylinder(i.radiusTop,i.radiusBottom,i.height,i.radialSegments);return r.radiusTop=i.radiusTop,r.radiusBottom=i.radiusBottom,r.height=i.height,r.numSegments=i.radialSegments,{shape:r,orientation:(new t.Quaternion).setFromEuler(n.MathUtils.degToRad(-90),0,0,"XYZ").normalize()}}(s);case"PlaneGeometry":case"PlaneBufferGeometry":return function(e){e.computeBoundingBox();var n=e.boundingBox;return{shape:new t.Box(new t.Vec3((n.max.x-n.min.x)/2||.1,(n.max.y-n.min.y)/2||.1,(n.max.z-n.min.z)/2||.1))}}(s);case"SphereGeometry":case"SphereBufferGeometry":return function(e){return{shape:new t.Sphere(e.parameters.radius)}}(s);case"TubeGeometry":case"BufferGeometry":return m(r);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',s.type),d(s)}}});
//# sourceMappingURL=three-to-cannon.umd.js.map
